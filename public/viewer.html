<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Advanced Dynamic React Component Renderer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/17.0.2/umd/react.development.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/17.0.2/umd/react-dom.development.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.26.0/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      // Function to get query parameters
      function getQueryParam(param) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param);
      }

      // Function to safely decode URI component
      function safeDecodeURIComponent(str) {
        try {
          return decodeURIComponent(str);
        } catch (e) {
          console.warn("Failed to decode:", str);
          return str;
        }
      }

      // Get the component definitions from the query parameter
      const componentDefinitions = getQueryParam("components");

      if (componentDefinitions) {
        try {
          // Safely decode the component definitions
          const decodedDefinitions =
            safeDecodeURIComponent(componentDefinitions);

          // Use Babel to transform the component definitions
          const transformedCode = Babel.transform(
            `
                    ${decodedDefinitions}
                    ReactDOM.render(
                        <React.StrictMode>
                            <App />
                        </React.StrictMode>,
                        document.getElementById('root')
                    );
                    `,
            {
              presets: ["react", "stage-2"],
              plugins: [
                "transform-object-rest-spread",
                "transform-class-properties",
                "transform-async-to-generator",
              ],
            }
          ).code;

          // Evaluate the transformed code
          eval(transformedCode);
        } catch (error) {
          console.error("Error rendering components:", error);
          document.getElementById(
            "root"
          ).innerHTML = `<p>Error rendering components: ${error.message}</p>`;
        }
      } else {
        document.getElementById("root").innerHTML =
          "<p>No component definitions provided in the query parameter.</p>";
      }
    </script>
  </body>
</html>
